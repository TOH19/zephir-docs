# Tutorial

Zephir y este libro, están destinados para desarrolladores PHP que desean crear extensiones en C, con una complejidad menor.

Asumimos que usted tiene experiencia en uno o varios lenguajes de programación. Trazaremos paralelismos entre las funciones de PHP, C, Javascript y otros lenguajes. Señalaremos características de Zephir que son similares a otros lenguajes, como también, muchas características que son nuevas o diferentes. Si estás familiarizado con estos lenguajes específicos, usted podrá entender estas comparaciones más rápidamente.

<a name='checking-the-installation'></a>

## Probando la Instalación

Si se ha instalado con éxito Zephir, usted será capaz de ejecutar el siguiente comando en la consola:

    $ zephir help
    

Si todo está bien, debería ver la siguiente ayuda (o algo muy similar):

     _____              __    _
    /__  /  ___  ____  / /_  (_)____
      / /  / _ \/ __ \/ __ \/ / ___/
     / /__/  __/ /_/ / / / / / /
    /____/\___/ .___/_/ /_/_/_/
             /_/
    
    Zephir version 0.10.9a-dev
    
    Usage:
        command [options]
    
    Available commands:
        stubs               Genera extensiones de apendices de PHP
        install             Instalar la extensión (requiere contraseña root)
        version             Muestra la versión actual de Zephir
        compile             Compilar un extensión de Zephir
        api [--theme-path=/path][--output-directory=/path][--theme-options={json}|/path]Genera el API en HTML
        init [namespace]    Inicia una extensión Zephir
        fullclean           Limpia los archivos de objetos generados en la compilación
        builddev            Genera/Compila/Instala una extensión Zephir en modo de desarrollo
        clean               Limpia los archivos de objetos generados en la compilación
        generate            Genera código C desde código Zephir
        help                Muestra esta ayuda
        build               Genera/Compila/Instala una extensión Zephir
    
    Options:
        -f([a-z0-9\-]+)     Habilita las optimizaciones del compilador
        -fno-([a-z0-9\-]+)  Dehabilita las optimizaciones del compilador
        -w([a-z0-9\-]+)     Enciende una advertencia
        -W([a-z0-9\-]+)     Apaga una advertencia
    

<a name='extension-skeleton'></a>

## Esqueleto de la Extensión

Lo primero que tenemos que hacer es generar un esqueleto de extensión. Esto le dará a nuestra extensión la estructura básica que necesitamos para empezar a trabajar. En nuestro caso, vamos a crear una extensión llamada `utils`:

    $ zephir init utils
    

Después de esto, un directorio llamado "utils" es creado en el directorio actual de trabajo:

    utils/
       ext/
       utils/
    

El directorio `ext/` (dentro del directorio utils) contiene el código que utilizará el compilador para producir la extensión. Otro directorio creado es `utils` este directorio tiene el mismo nombre que nuestra extensión. Aquí pondremos nuestro código Zephir.

Necesitamos cambiar el directorio de trabajo a "utils" para comenzar a copilar nuestro código:

    $ cd utils
    $ ls
    ext/ utils/ config.json
    

Al listar el directorio, nos mostrará un archivo llamado `config.json`. Este archivo contiene los ajustes de configuración que podemos usar para alterar el comportamiento de Zephir y/o la extensión en sí.

<a name='adding-our-first-class'></a>

## Agregando nuestra primer clase

Zephir is designed to generate object-oriented extensions. To start developing functionality, we need to add our first class to the extension.

As in many languages/tools, the first thing we want to do is see a `hello world` generated by Zephir, and check that everything is well. So our first class will be called `Utils\Greeting`, and contain a method printing `hello world!`.

The code for this class must be placed in `utils/utils/greeting.zep`:

    namespace Utils;
    
    class Greeting
    {
    
        public static function say()
        {
            echo "¡hola mundo!";
        }
    
    }
    

Now, we need to tell Zephir that our project must be compiled and the extension generated:

    $ zephir build
    

Initially, and only for the first time, a number of internal commands are executed producing the necessary code and configurations to export this class to the PHP extension. If everything goes well, you will see the following message at the end of the output:

    ...
    Extension installed!
    Add extension=utils.so to your php.ini
    Don't forget to restart your web server
    

At the above step, it's likely that you would need to supply your root password in order to install the extension.

Finally, the extension must be added to the `php.ini` in order to be loaded by PHP. This is achieved by adding the initialization directive: `extension=utils.so` to it. (NOTE: You can also load it on the command line with `-d extension=utils.so`, but it will only load for that single request, so you'd need to include it every time you want to test your extension in the CLI. Adding the directive to the `php.ini` will ensure it is loaded for every request from then on.)

<a name='initial-testing'></a>

## Prueba Inicial

Now that the extension was added to your php.ini, check whether the extension is being loaded properly by executing the following:

    $ php -m
    [PHP Modules]
    Core
    date
    libxml
    pcre
    Reflection
    session
    SPL
    standard
    tokenizer
    utils
    xdebug
    xml
    

Extension `utils` should be part of the output, indicating that the extension was loaded correctly. Now, let's see our `hello world` directly executed by PHP. To accomplish this, you can create a simple PHP file calling the static method we have just created:

    <?php
    
    echo Utils\Greeting::say(), "\n";
    

Congratulations!, you have your first extension running in PHP.

<a name='a-useful-class'></a>

## Una clase útil

The `hello world` class was fine to check if our environment was right. Now, let's create some more useful classes.

The first useful class we are going to add to this extension will provide filtering facilities to users. This class is called `Utils\Filter` and its code must be placed in `utils/utils/filter.zep`:

A basic skeleton for this class is the following:

    namespace Utils;
    
    class Filter
    {
    
    }
    

The class contains filtering methods that help users to filter unwanted characters from strings. The first method is called `alpha`, and its purpose is to filter only those characters that are ASCII basic letters. To begin, we are just going to traverse the string, printing every byte to the standard output:

    namespace Utils;
    
    class Filter
    {
    
        public function alpha(string str)
        {
            char ch;
    
            for ch in str {
                echo ch, "\n";
            }
        }
    }
    

When invoking this method:

    <?php
    
    $f = new Utils\Filter();
    $f->alpha("hola");
    

Usted verá:

    h
    o
    l
    a
    

Checking every character in the string is straightforward. Now we'll create another string with the right filtered characters:

    class Filter
    {
    
        public function alpha(string str) -> string
        {
            char ch; string filtered = "";
    
            for ch in str {
                if (ch >= 'a' && ch <= 'z') || (ch >= 'A' && ch <= 'Z') {
                    let filtered .= ch;
                }
            }
    
            return filtered;
        }
    }
    

El método completo se puede probar como antes:

    <?php
    
    $f = new Utils\Filter();
    echo $f->alpha("!ho#02l3'121a."); // imprime "hola"
    

En el siguiente video tutorial puedes ver como crear la extensión explicada en este tutorial: <iframe src="//player.vimeo.com/video/84180223" width="500" height="313" frameborder="0" webkitallowfullscreen mozallowfullscreen allowfullscreen mark="crwd-mark"></iframe> 

<a name='conclusion'></a>

## Conclusión

Este es un tutorial muy simple y como se puede ver, es fácil empezar a construir una extensión usando Zephir. Te invitamos a seguir leyendo el manual para que puedas descubrir algunas funciones adicionales que ofrece Zephir!